!function(){function e(){const e=document.querySelectorAll(".modal-open");for(let t=0;t<e.length;t++)e[t].removeEventListener("click",n),e[t].addEventListener("click",n)}const t=document.querySelector(".modal-overlay");function n(){const e=document.querySelector("body"),t=document.querySelector(".modal");t.classList.toggle("opacity-0"),t.classList.toggle("pointer-events-none"),e.classList.toggle("modal-active")}let o,r=[];function a(e){e.preventDefault(),document.querySelector(".header").classList.add("active"),document.getElementById("construction-container").style.display="none",document.getElementById("map-container").style.display="none",document.getElementById("loading").style.display="block";const t={query:`${e.target[0].value}, Singapore`,fields:["name","geometry","formatted_address","plus_code","place_id"]};(function(e){return function(t){return new Promise(((n,o)=>{e.findPlaceFromQuery(t,((e,t)=>{t===google.maps.places.PlacesServiceStatus.OK?n(e):o(new Error(`Request failed with status ${t}`))}))}))}})(new google.maps.places.PlacesService(o))(t).then((e=>{const t=e[0],n=t.geometry.location.lng(),r=t.geometry.location.lat();var a;return document.getElementById("address").textContent=t.formatted_address,document.querySelector('#review-form [name="formatted_address"]').value=t.formatted_address,document.querySelector('#review-form [name="lng"]').value=n,document.querySelector('#review-form [name="lat"]').value=r,a=t,new google.maps.Marker({map:o,position:a.geometry.location}),o.setCenter(t.geometry.location),o.setZoom(17),function(e,t){return new Promise((n=>{fetch(`https://api.ismylandlordnice.com/api/reviews?lat=${t}&lng=${e}`).then((e=>[e.status,e.json()])).then((([e,t])=>e>299||e<200?[]:t)).then((e=>{n(e.map((e=>{for(const t in e)e[t]=i(e[t]);return e})))})).catch((e=>{console.error(e),n([])}))}))}(n,r)})).then((e=>{l(e),c("map")})).catch((()=>{c("construction")}))}function c(e="map"){document.getElementById(`${e}-container`).style.display="block",document.getElementById("loading").style.display="none"}function l(t){r=t,function(){if(0===r.length)return document.getElementById("review").innerHTML='\n    <hr />\n    <div class="review-entry">\n        <h4 class="text-md">No reviews nearby here yet.\n            <button class="modal-open hover:underline text-blue-500">Submit one?</button>\n        </h4>\n    </div>',void e();document.getElementById("review").innerHTML=r.map((e=>`\n    <hr />\n    <div class="review-entry">\n        <h4 class="text-md font-bold">${e.formatted_address} #${e.floor} - ${e.unit_number}</h4>\n        <p class="text-sm">${e.author?e.author.name:"Anonymous"}</p>\n        <p class="mt-1">${e.review_text}</p>\n    </div>\n  `)).join("")}()}function i(e){var t=document.createElement("p");return t.appendChild(document.createTextNode(e)),t.innerHTML}function s(e){e.preventDefault();const t={formatted_address:document.querySelector('#review-form [name="formatted_address"]').value,lat:parseFloat(document.querySelector('#review-form [name="lat"]').value),lng:parseFloat(document.querySelector('#review-form [name="lng"]').value),floor:document.querySelector('#review-form [name="floor"]').value,unit_number:document.querySelector('#review-form [name="unit_number"]').value,review_text:document.querySelector('#review-form [name="review_text"]').value};document.querySelector('#review-form button[type="submit"]').setAttribute("disabled",!0),document.querySelector('#review-form button[type="submit"]').textContent="Submitting...",fetch("https://api.ismylandlordnice.com/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>Promise.all([e.status,e.json()]))).then((([e,t])=>{if(e>299||e<200)throw new Error(t.message);l([t,...r]),n()})).catch((e=>function(e){const t=document.getElementById("error-message");t.textContent=e,t.classList.remove("hidden"),setTimeout((()=>{t.textContent="",t.classList.add("hidden")}),5e3)}(e.message))).finally((()=>{document.querySelector('#review-form button[type="submit"]').removeAttribute("disabled"),document.querySelector('#review-form button[type="submit"]').textContent="Submit"}))}document.addEventListener("DOMContentLoaded",(function(){fetch("https://api.ismylandlordnice.com"),function(){t.addEventListener("click",n);const e=document.querySelectorAll(".modal-close");for(var o=0;o<e.length;o++)e[o].addEventListener("click",n);document.onkeydown=function(e){("key"in(e=e||window.event)?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&document.body.classList.contains("modal-active")&&n()}}(),e(),o=new google.maps.Map(document.getElementById("map"),{center:{lat:1.3521,lng:103.8198},zoom:11}),document.getElementById("search").addEventListener("submit",a),document.querySelector("#review-form").addEventListener("submit",s)}),!1)}();
//# sourceMappingURL=index.8be3b25a.js.map
